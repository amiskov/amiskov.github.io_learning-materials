---
title: jQuery Ajax
author: amiskov
date: 2015-08-27 10:30
template: article.jade
---

Объект `XMLHttpRequest` позволяет браузеру обращаться к серверу без перезагрузки страницы. Посылается асинхронный запрос
на URL, сервер отдает данные, котоыре можно обработать в коллбэк-функции. Асинхронный — значит не блокирующий. То 
есть остальной код может продолжать исполняться во время выполнения запроса. Асинхронные запросы требуют времени на 
выполнение и могут быть обработаны не сразу. Для этого используются коллбэки и некоторые другие штуки.

<span class="more"></span>

Так работать не будет:

```js
    var response;
     
    $.get( "foo.php", function( r ) {
        response = r;
    });
     
    console.log( response ); // undefined
```

А так будет:

```js
    $.get( "foo.php", function( response ) {
        console.log( response ); // server response
    });
```

Ajax — Asynchronous JavaScript and XML. Однако, XML тут по историческим причинам. В основном обмен данными происходит
в формате [JSON][2] или просто HTML.

## Кроссдоменные запросы
Раньше браузеры не позволяли делать посылать ajax-запросы на другие домены. Обходной путь — JSONP. Запросы 
осуществляются через тег `<script>`. Современные браузеры используют [Cross-Origin Resource Sharing (CORS)][1].

Чтобы аякс-запрос обработался, клиент и сервер должны быть на одном домене, использовать одни и тот же протокол 
(http/https) и общаться по одному и тому же порту. Это ограничение не распространяется на скрпты, загружаемые через 
аяксовые методы jQuery.

JSNP обходит эти ограничения, релазиуя передачу данных, которые будут записаны в тег `<script>`. Сервер возвращает 
скрипт, который будет обернут в коллбэк-функцию, которую мы ему назовем.

[1] http://caniuse.com/#search=CORS
[2] http://json.org/json-ru.html

## Основные понятия
### GET и POST
`GET`-запрос нужен для получения данных. Не для изменения или удаления, а просто для того, чтобы что-то узнать. Такие
запросы кешируются браузерами и посылаются как параметры в адресной строке браузера.
Например, `https://www.google.ru/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=json`

`POST`-запросы используются для изменения данных на сервере: добавить пользователя, удалить товар, изменить пароль и 
пр. Такие запросы браузер не кеширует и данные не видны в адресной строке.

### Типы данных
Данные могут быть получены в разном виде:

* text — обычные строковые данные
* html — блоки html-кода
* script — для добавления нового тега script на страницу
* JSON — передача строк, массивов и объектов
* JSONP — JSON с другого домена
* XML

В основном используется JSON.

## Методы для работы с аяксом
Основной функционал в jQuery реализует метод `$.ajax`. Остальные методы — шорткаты.

Рекомендуется использовать синтаксис `$.ajax` для любых запросов (?).

## Работа с формами
## Сериализация
`serialize()` — представляет данные формы в виде строки запроса (query string). Каждый элемент формы должен иметь 
атрибут `name`. Значения инпутов `checkbox` и `radio` добавятся только если они отмечены.

```js
// Turning form data into a query string
$( "#myForm" ).serialize();
 
// Creates a query string like this:
// field_1=something&field2=somethingElse
```

`serializeArray` — представляет данные формы в виде массива объектов:

```js
// Creating an array of objects containing form data
$( "#myForm" ).serializeArray();
 
// Creates a structure like this:
// [
//   {
//     name : "field_1",
//     value : "something"
//   },
//   {
//     name : "field_2",
//     value : "somethingElse"
//   }
// ]
```

## Валидация

## Префильтер

## JSONP
Создается тег скрипт, в src добавляется нужный URL. Начинается загрузка. Сервер отдает данные, обернутые в 
функцию-коллбэк. Название функции заранее оговорено, все о нем знают. Клиент полностью доверяет серверу:

```js
// Добавляем скрипт
addScript('user?id=123&callback=onUserData'); // функция сгенерирует <script src="user?id=..."> и добавить в head
// ответ сервера
onUserData({
  name: "Вася",
  age: 25
});
```

## Материалы
* https://learn.jquery.com/ajax/
* http://learn.javascript.ru/json
* http://learn.javascript.ru/ajax-jsonp
* http://api.jquery.com/category/ajax/
* http://www.html5rocks.com/en/tutorials/cors/
